{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 377e3b3e6e88f3b91201","webpack:///./src/index.js","webpack:///./src/html.js"],"names":["Conversation","configSelector","playerSelector","typeDelay","config","document","querySelector","player","blocks","querySelectorAll","map","id","block","attributes","value","title","innerHTML","played","sentences","questions","remove","answer","createElement","classList","add","inner","appendChild","_playBlock","length","forEach","button","onclick","_answer","scrollIntoView","Math","random","letters","sentence","htmlMap","doneCallback","text","strip","shift","inject","setTimeout","_playLetter","_getTypeDelay","style","height","_playSentence","_showQuestions","filter","find","voidElements","isVoidElement","tag","tagName","match","Boolean","indexOf","toLowerCase","str","replace","regexp","tags","openers","result","exec","position","index","charAt","opener","pop","push","i","substr"],"mappings":"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","file":"conversation.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"conversationJS\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"conversationJS\"] = factory();\n\telse\n\t\troot[\"conversationJS\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 377e3b3e6e88f3b91201\n **/","import html from './html'\n\nexport default class Conversation {\n  constructor (configSelector, playerSelector, typeDelay = [50, 100]) {\n    this.typeDelay = typeDelay\n    this.config = document.querySelector(configSelector)\n    this.player = document.querySelector(playerSelector)\n\n    // extract the main data structure\n    this.blocks = [...this.config.querySelectorAll('[step=\"0\"]')].map(block => {\n      return {\n        id: block.attributes.block.value,\n        title: block.innerHTML,\n        played: false,\n        sentences: this.config.querySelectorAll(`[block=\"${block.attributes.block.value}\"]:not([step=\"0\"])`)\n      }\n    })\n  }\n\n  _answer (block) {\n    this.questions.remove()\n    let answer = document.createElement('div')\n    answer.classList.add('questions')\n    answer.classList.add('answered')\n    let inner = document.createElement('span')\n    inner.innerHTML = block.title\n    answer.appendChild(inner)\n    this.player.appendChild(answer)\n    this._playBlock(block)\n  }\n\n  _showQuestions (blocks) {\n    if (blocks.length === 0) return\n    this.questions = document.createElement('div')\n    this.questions.classList.add('questions')\n    blocks.forEach(block => {\n      let button = document.createElement('button')\n      button.innerHTML = block.title\n      button.onclick = () => { this._answer(block) }\n      this.questions.appendChild(button)\n    })\n    this.player.appendChild(this.questions)\n    this.questions.scrollIntoView()\n  }\n\n  _getTypeDelay () {\n    return Math.random() * (this.typeDelay[1] - this.typeDelay[0]) + this.typeDelay[0]\n  }\n\n  _playLetter (letters, sentence, htmlMap, doneCallback) {\n    if (letters.length === 0) {\n      return doneCallback()\n    }\n    let text = html.strip(sentence.innerHTML) + letters.shift()\n    sentence.innerHTML = html.inject(text, htmlMap)\n    // schedule the next letter after type delay\n    setTimeout(() => {\n      this._playLetter(letters, sentence, htmlMap, doneCallback)\n    }, this._getTypeDelay())\n  }\n\n  _playSentence (sentences, doneCallback) {\n    if (sentences.length === 0) {\n      return doneCallback()\n    }\n    let sentence = sentences.shift()\n    sentence.style.height = '60px'\n    // inject a span to allow flexbox centering\n    let text = `<span>${sentence.innerHTML}</span>`\n    let htmlMap = html.map(text)\n    let letters = [...html.strip(text)]\n    sentence.innerHTML = ''\n    this._playLetter(letters, sentence, htmlMap, () => {\n      // this sentence has finished playing, queue the next\n      sentence.classList.remove('is-typing')\n      this._playSentence(sentences, doneCallback)\n    })\n    sentence.classList.add('is-typing')\n    this.player.appendChild(sentence)\n    sentence.scrollIntoView()\n  }\n\n  _playBlock (block) {\n    block.played = true\n    this._playSentence([...block.sentences], () => {\n      this._showQuestions(this.blocks.filter(block => !block.played))\n    })\n  }\n\n  play () {\n    this._playBlock(this.blocks.find(block => block.id === 'start'))\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/index.js\n **/","let voidElements = [\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'keygen',\n  'link',\n  'menuitem',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr'\n]\n\nfunction isVoidElement (tag) {\n  const tagName = tag.match(/<([^\\s>]+)/)\n  return Boolean(tagName) && voidElements.indexOf(tagName[1].toLowerCase()) > -1\n}\n\nexport default {\n  strip (str) {\n    return str.replace(/(<([^>]+)>)/gi, '')\n  },\n\n  map (str) {\n    let regexp = /<[^>]+>/gi\n    let tags = []\n    let openers = []\n    let result\n    let tag\n\n    while ((result = regexp.exec(str))) {\n      tag = {\n        tagName: result[0],\n        position: result.index\n      }\n\n      if (tag.tagName.charAt(1) === '/') {\n        tag.opener = openers.pop()\n      } else if (tag.tagName.charAt(tag.tagName.length - 2) !== '/' && !isVoidElement(tag.tagName)) {\n        openers.push(tag)\n      }\n\n      tags.push(tag)\n    }\n\n    return tags\n  },\n\n  inject (str, map) {\n    for (let i = 0, tag; i < map.length; i++) {\n      tag = map[i]\n\n      if (str.length > 0 && tag.position <= str.length) {\n        str = str.substr(0, tag.position) + tag.tagName + str.substr(tag.position)\n      } else if (tag.opener && tag.opener.position < str.length) {\n        str += tag.tagName\n      }\n    }\n\n    return str\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/html.js\n **/"],"sourceRoot":""}