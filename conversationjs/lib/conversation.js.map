{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 8ec3dcd356c29e34d2dc","webpack:///./src/index.js","webpack:///./src/html.js"],"names":["Conversation","configSelector","playerSelector","typeDelay","animationClass","config","document","querySelector","player","blocks","querySelectorAll","map","id","block","attributes","value","title","innerHTML","played","sentences","element","classes","forEach","classList","add","cssClass","questions","remove","answer","createElement","_addClasses","inner","appendChild","_playBlock","length","questionsInner","button","onclick","_answer","scrollIntoView","behavior","Math","random","letters","sentence","htmlMap","doneCallback","text","strip","shift","inject","setTimeout","_playLetter","_getTypeDelay","_playSentence","_showQuestions","filter","find","voidElements","isVoidElement","tag","tagName","match","Boolean","indexOf","toLowerCase","str","replace","regexp","tags","openers","result","exec","position","index","charAt","opener","pop","push","i","substr"],"mappings":"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","file":"conversation.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"conversationJS\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"conversationJS\"] = factory();\n\telse\n\t\troot[\"conversationJS\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 8ec3dcd356c29e34d2dc\n **/","import html from './html'\n\nexport default class Conversation {\n  constructor (configSelector, playerSelector, typeDelay = [25, 50], animationClass = 'fadeInDown') {\n    this.animationClass = animationClass\n    this.typeDelay = typeDelay\n    this.config = document.querySelector(configSelector)\n    this.player = document.querySelector(playerSelector)\n\n    // extract the main data structure\n    this.blocks = [...this.config.querySelectorAll('[step=\"0\"]')].map(block => {\n      return {\n        id: block.attributes.block.value,\n        title: block.innerHTML,\n        played: false,\n        sentences: this.config.querySelectorAll(`[block=\"${block.attributes.block.value}\"]:not([step=\"0\"])`)\n      }\n    })\n  }\n\n  _addClasses (element, classes) {\n    classes.forEach(cssClass => {\n      element.classList.add(cssClass)\n    })\n  }\n\n  _answer (block) {\n    this.questions.remove()\n    let answer = document.createElement('div')\n    this._addClasses(answer, ['questions', 'answered'])\n    let inner = document.createElement('span')\n    inner.innerHTML = block.title\n    answer.appendChild(inner)\n    this.player.appendChild(answer)\n    this._addClasses(answer, ['animated', 'fadeInLeft'])\n    this._playBlock(block)\n  }\n\n  _showQuestions (blocks) {\n    if (blocks.length === 0) return\n    this.questions = document.createElement('div')\n    this.questions.classList.add('questions')\n    let questionsInner = document.createElement('div')\n    this.questions.appendChild(questionsInner)\n    blocks.forEach(block => {\n      let button = document.createElement('button')\n      button.innerHTML = block.title\n      button.onclick = () => { this._answer(block) }\n      questionsInner.appendChild(button)\n    })\n    this.player.appendChild(this.questions)\n    this.questions.scrollIntoView({behavior: 'smooth'})\n    this._addClasses(this.questions, ['animated', 'fadeInUp'])\n  }\n\n  _getTypeDelay () {\n    return Math.random() * (this.typeDelay[1] - this.typeDelay[0]) + this.typeDelay[0]\n  }\n\n  _playLetter (letters, sentence, htmlMap, doneCallback) {\n    if (letters.length === 0) {\n      return doneCallback()\n    }\n    let text = html.strip(sentence.innerHTML) + letters.shift()\n    sentence.innerHTML = html.inject(text, htmlMap)\n    // schedule the next letter after type delay\n    setTimeout(() => {\n      this._playLetter(letters, sentence, htmlMap, doneCallback)\n    }, this._getTypeDelay())\n  }\n\n  _playSentence (sentences, doneCallback) {\n    if (sentences.length === 0) {\n      return doneCallback()\n    }\n    let sentence = sentences.shift()\n    // inject a span to allow flexbox centering\n    let text = `<span>${sentence.innerHTML}</span>`\n    let htmlMap = html.map(text)\n    let letters = [...html.strip(text)]\n    sentence.innerHTML = ''\n    this._playLetter(letters, sentence, htmlMap, () => {\n      // this sentence has finished playing, queue the next\n      sentence.classList.remove('is-typing')\n      this._playSentence(sentences, doneCallback)\n    })\n    sentence.classList.add('is-typing')\n    this.player.appendChild(sentence)\n    sentence.scrollIntoView({behavior: 'smooth'})\n    // flipInX\n    this._addClasses(sentence, ['animated', this.animationClass])\n  }\n\n  _playBlock (block) {\n    block.played = true\n    this._playSentence([...block.sentences], () => {\n      this._showQuestions(this.blocks.filter(block => !block.played))\n    })\n  }\n\n  play () {\n    this._playBlock(this.blocks.find(block => block.id === 'start'))\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/index.js\n **/","let voidElements = [\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'keygen',\n  'link',\n  'menuitem',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr'\n]\n\nfunction isVoidElement (tag) {\n  const tagName = tag.match(/<([^\\s>]+)/)\n  return Boolean(tagName) && voidElements.indexOf(tagName[1].toLowerCase()) > -1\n}\n\nexport default {\n  strip (str) {\n    return str.replace(/(<([^>]+)>)/gi, '')\n  },\n\n  map (str) {\n    let regexp = /<[^>]+>/gi\n    let tags = []\n    let openers = []\n    let result\n    let tag\n\n    while ((result = regexp.exec(str))) {\n      tag = {\n        tagName: result[0],\n        position: result.index\n      }\n\n      if (tag.tagName.charAt(1) === '/') {\n        tag.opener = openers.pop()\n      } else if (tag.tagName.charAt(tag.tagName.length - 2) !== '/' && !isVoidElement(tag.tagName)) {\n        openers.push(tag)\n      }\n\n      tags.push(tag)\n    }\n\n    return tags\n  },\n\n  inject (str, map) {\n    for (let i = 0, tag; i < map.length; i++) {\n      tag = map[i]\n\n      if (str.length > 0 && tag.position <= str.length) {\n        str = str.substr(0, tag.position) + tag.tagName + str.substr(tag.position)\n      } else if (tag.opener && tag.opener.position < str.length) {\n        str += tag.tagName\n      }\n    }\n\n    return str\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/html.js\n **/"],"sourceRoot":""}